<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Visualización de la distribución de vulnerabilidades en CVE</title>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="./sqljs/v1.12.0/sql-wasm.js"></script>
    <style>
      html, body, svg {
          margin: 0;
          padding: 0;
          width: 100vw;
          height: 100vh;
      }
    </style>
  </head>
  <body>
    <nav id="testbar">
      <input
        style="width: 100%; display: block;"
        type="text"
        id="cmdbar"
        value="" />
      <button onclick="cmdbar.value = 'SELECT CONCAT(cvssData__accessVector, \' & \', cvssData__accessComplexity) as CX, COUNT(*) FROM nist_cve__metrics__cvssMetricV2 GROUP BY CX;';">
        qVectores
      </button>
      <button onclick="cmdbar.value = 'SELECT baseSeverity, COUNT(*) FROM nist_cve__metrics__cvssMetricV2 GROUP BY baseSeverity;'">
        qSevCat
      </button>
      <button onclick="cmdbar.value = 'SELECT ROUND(cvssData__baseScore) as CX, COUNT(*) FROM nist_cve__metrics__cvssMetricV2 GROUP BY CX;'">
        qSevScores
      </button>
      <button onclick="cmdbar.value = `SELECT
    [CWE-ID],
    IFNULL(METRICS.cvssV3_1__baseSeverity,
    IFNULL(METRICS.cvssV4_0__baseSeverity,
    IFNULL(METRICS.cvssV3_0__baseSeverity,
    NULL
    ))),
    COUNT(*)
FROM cwe AS CWE
JOIN cve__containers__cna__problemTypes__0__descriptions as DESCR
    ON 'CWE-' || CWE.[CWE-ID] = DESCR.cweId
JOIN cve__containers__cna__problemTypes AS PROBS
    ON DESCR.__parent__ = PROBS.rowid
JOIN cve AS CVE
    ON PROBS.__parent__ = cve.rowid
JOIN cve__containers__cna__metrics AS METRICS
    ON CVE.rowid = METRICS.__parent__
    GROUP BY [CWE-ID]
    ;`.replaceAll('\n', '  ');">
        qCweBySev
      </button>
      <button name="barplot">Barplot</button>
      <button name="lineplot">Lineplot</button>
      <button name="areaplot">Areaplot</button>
    </nav>

    <svg id="viz_area"></svg>  <!-- height="100vh" width="100vw" -->

    <script src="./plots/barplot.js"></script>
    <script src="./plots/lineplot.js"></script>
    <script src="./plots/areaplot.js"></script>
    <script src="./run-viz.js"></script>
  </body>
</html>
